<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://ihiteish.github.io/weather_app/style.css">
    <title>Today's Weather</title>
  </head>
  <body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-12 text-center jumbotron top">
                <h1>Today's Weather</h1>
                <hr class="short">
                <h2 id="weather">Loading...</h2>
            </div>
        </div>
        <div class="row text">
            <div class="col-sm-12 text-center grey-jumbo">
                <div class="text-center">
                    <h3 id="tagline"></h3>
                </div>
                <hr class="below">
                <div class="col-sm-4">
                    <h3 id="time"></h3>
                    <hr class="short">
                    <h3 id="wind"></h3>
                </div>
                <div class="col-sm-4">
                    <h3 id="temp"></h3>
                    <button id="switch" class="btn btn-primary">Show in Fahrenheit</button>
                </div>
                <div class="col-sm-4">
                    <h3 id="sky"></h3>
                    <hr class="short">
                    <h3 id="humidity"></h3>
                </div>
            </div>
        </div>
    </div>
    <div class="container black">
      <div class="row">
        <div class="col-sm-8">
          Developed by <a href="https://facebook.com/ihiteish" target="_BLANK">Hitesh Yadav</a> | API used from <a href="http://apixu.com" target="_BLANK">apixu.com</a>
        </div>
        <div class="col-sm-4">
          Last Updated on <span id="last_update"></span>
        </div>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="https://ihiteish.github.io/weather_app/main.js" type="text/javascript" charset="utf-8"></script>
    <script>
      $(document).ready(function(){
  if(navigator.geolocation){
    var currentPosition = '';
    navigator.geolocation.getCurrentPosition(function(position){
      currentPosition = position;
      var latitude = position.coords.latitude;
      var longitude = position.coords.longitude;

      var url = 'http://api.apixu.com/v1/current.json?key=bf8b4da2346c425c947102440183101&q=';

      $.getJSON(url+latitude+','+longitude,function(data){
        var data = JSON.stringify(data);
        var json = JSON.parse(data);

        var country = json.location.country;
        var state = json.location.region;
        var city = json.location.name;
        var temp = json.current.temp_c;
        var temp_f = json.current.temp_f;
        var last_updated = json.current.last_updated.replace('-',' ');

        var wind = json.current.wind_kph;
        var humidity = json.current.humidity;
        var local_time = json.location.localtime.split(' ')[1];

        var cloud = json.current.cloud;
        $('#weather').html(city+', '+state+', '+country);
        $('#temp').html(temp+'&#x2103;');

        var yes = true;
        $('#switch').on('click',function(){
          if(yes){
            $('#temp').html(temp_f+'&#x2109;');
            $('#switch').html('Change in Celsius');
            yes = false;
          }else{
            $('#temp').html(temp+'&#x2103;');
            $('#switch').html('Change in Fahrenheit');
            yes = true;
          }
        });

        $('#time').html(local_time);
        $('#wind').html('Wind '+wind+' Kph');
        $('#humidity').html('Humidity : '+humidity+'%');

        if(cloud <= 32){
          $('#sky').html('Clear Sky');
        }else{
          $('#sky').html('Cloudy Sky');
        }

        var time_round = local_time.replace(':','');
        if(time_round > 1900 || time_round < 0600){
          $('.grey-jumbo').css({background: 'url(images/night.jpg)',backgroundSize:'cover'});
          $('#tagline').html('Good Night');
        }else{
          if(humidity > 65){
            $('.grey-jumbo').css({background: 'url(images/rainy.jpg)',backgroundSize:'cover'});
            $('#tagline').html('Its High Humidity Today in atmosphere');
          }else{
            if(temp >= 38){
              $('.grey-jumbo').css({background: 'url(images/hot.jpg)',backgroundSize:'cover'});
              $('#tagline').html('Its Hot Day today');
            }else if(temp >= 20 && temp <38){
              $('.grey-jumbo').css({backgroundImage: 'url(images/sunny.jpg)',backgroundSize:'cover'});
              $('#tagline').html('Its Sunny Day Today');
            }else if(temp < 20){
              $('.grey-jumbo').css({background: 'url(images/cold.jpg)',backgroundSize:'cover'});
              $('#tagline').html('Its Cold Day Today');
            }
          }
        }
        $('#last_update').html(last_updated);
      });
    });
  }
});
    </script>
  </body>
</html>
